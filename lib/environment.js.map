{"version":3,"sources":["../src/environment.js"],"names":["environment","runtime","framework","virtualEnv","isWeb","platform","isWeexiOS","isWeexAndroid","isWeex","UA","window","navigator","userAgent","toLowerCase","PCFrameConf","tempConf","frameName","name","frameConf","JSON","parse","containerId","version","hostVersion","language","e","isDingTalk","appName","indexOf","matches","match","appVersion","isPC","isWebiOS","test","isiPad","isWebAndroid","isDingTalkPCMac","isDingTalkPCWindows","isDingTalkPCWeb","isDingTalkPC","IOS","ANDROID","IPAD","MAC","WINDOWS","BROWSER","UNKNOWN"],"mappings":"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","file":"environment.js","sourcesContent":["import { PLATFORM } from './constants.js';\n\nexport default function environment(runtime,framework,virtualEnv){\n  const isWeb = virtualEnv.platform === 'Web';\n  const isWeexiOS = virtualEnv.platform === 'iOS';\n  const isWeexAndroid = virtualEnv.platform === 'android';\n  const isWeex = isWeexAndroid || isWeexiOS;\n  const UA = (() => {\n    if(isWeb){\n      return window.navigator.userAgent.toLowerCase();\n    }\n    return '';\n  })();\n  const PCFrameConf = (() => {\n    let tempConf = {}\n    if(isWeb){\n      const frameName = window.name;\n      try{\n        const frameConf = JSON.parse(frameName);\n        tempConf.containerId = frameConf.containerId;\n        tempConf.version = frameConf.hostVersion;\n        tempConf.language = frameConf.language || '*';\n      }catch(e){\n        \n      }\n    }\n    return tempConf;\n  })();\n  const isDingTalk = (() => {\n    if (isWeex){\n      if (virtualEnv.appName === 'DingTalk' || virtualEnv.appName === 'com.alibaba.android.rimet'){\n        return true;\n      }\n      return false;\n    } else {\n      if (UA.indexOf('dingtalk') > -1 || UA.indexOf('aliapp') > -1){\n        return true;\n      } else {\n        return !!PCFrameConf.containerId\n      }\n    }\n  })();\n  const version = (() => {\n    if (isWeb){\n      if (PCFrameConf.version){\n        return PCFrameConf.version;\n      } else {\n        let matches = UA.match(/aliapp\\(\\w+\\/([a-zA-Z0-9.-]+)\\)/);\n        if (matches === null) {\n            matches = UA.match(/dingtalk\\/([a-zA-Z0-9.-]+)/);\n        }\n        let version = (matches && matches[1]) ;\n        return version || 'Unknown';\n      }\n    } else {\n      return virtualEnv.appVersion;\n    }\n  })();\n  const isPC = !!PCFrameConf.containerId;\n  const isWebiOS = /iphone|ipod|ios/.test(UA);\n  const isiPad = /ipad/.test(UA);\n  const isWebAndroid = UA.indexOf('android') > -1;\n  const isDingTalkPCMac = (UA.indexOf('mac') > -1) && isPC;\n  const isDingTalkPCWindows = (UA.indexOf('win') > -1) && isPC;\n  const isDingTalkPCWeb = (!isDingTalkPCMac && !isDingTalkPCWindows) && isPC;\n  const isDingTalkPC = isPC;\n  let platform = '';\n  if (isDingTalk){\n    if (isWebiOS || isWeexiOS){\n      platform = PLATFORM.IOS;\n    } else if (isWebAndroid || isWeexAndroid){\n      platform = PLATFORM.ANDROID;\n    } else if (isiPad){\n      platform = PLATFORM.IPAD;\n    } else if (isDingTalkPCMac){\n      platform = PLATFORM.MAC;\n    } else if (isDingTalkPCWindows){\n      platform = PLATFORM.WINDOWS;\n    } else if (isDingTalkPCWeb){\n      platform = PLATFORM.BROWSER;\n    } else {\n      platform = PLATFORM.UNKNOWN;\n    }\n  } else {\n    platform = PLATFORM.UNKNOWN;\n  }\n  return {\n    isDingTalk,\n    isWebiOS,\n    isWebAndroid,\n    isWeexiOS,\n    isWeexAndroid,\n    isDingTalkPCMac,\n    isDingTalkPCWeb,\n    isDingTalkPCWindows,\n    isDingTalkPC,\n    runtime,\n    framework,\n    platform,\n    version\n  }\n}"]}